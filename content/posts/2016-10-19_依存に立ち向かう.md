---
categories: "javascript"
comments: true
date: 2016-10-19T20:30:44+09:00
image: ""
layout: post
published: false
tags:
- ""
title: 依存に立ち向かう
# todo: コードの整合性の確認
---

# 例えばこういう場合

「3つあるボタンのうちの一番上の赤い文字クリックしたらalertを出す」


# html側を書いて

```html
<ul class="wordList">
  <li><span>fuga</span></li>
  <li><span class='red'>ここをクリック</span></li>
  <li><span class='red'>hoge</span></li>
</ul>
```

# cssで赤くして

```css
.wordList > li > button.red {
  background: red
}
```

# JavaScriptで(jQuery使って)こんな感じに

```javascript
$('.buttonList').children[0].on('click', function() { alert('click されました'); })
```


# でもここで問題があります

何でしょう？

# Answer

* htmlの構造が変えると壊れる
  * htmlのクラス名が変わると壊れる
  * listの順序を変えると壊れる

# 結構よくある

## とあるデザイナの人

> html、cssをベースに仕事を進めていて、
> 途中でリデザインが発生してデザイン修正を行った。共通部分のcssを切り出して共通化した。
> しかしクラスを当て変えたらjavascriptが動かなくなった。

## とあるサーバサイドエンジニア

> 途中からRailsのプロジェクトに参加。
> 既存のフォームの改修を行った。
> フォームのボタンの配置を変えたら何故か動かなくなった。

# 問題の原因


## 分かれているファイルを全部頭に入っていなかった

関係するHTMLとJavaScript、CSSがファイルとして分かれている。
関係する部分が分かれているのでhtmlを修正するタイミングでjsが壊れることに気づけなかった。

> 関連してjavascriptとCSSがグローバルに扱えてしまう問題がある。がここでは割愛

# だったら一緒にしたほうが良いのでは？

htmlのスタイル属性に全部直書き、JavaScriptはonclick属性で全部直書きする。
これならリスト順序変えてもクラス名変えても壊れない

# まとめる単位と意味

実際、プログラミングで関係のあるものは近くにあるとわかりやすい。

テンプレートとスタイルと動作(js)を別々に切り出し、 "動き"を一箇所にまとめたりしたDRYにするほうが良い。
テンプレートとスタイルと動作を別で管理した方が(作業効率的に)都合がよいので分けている。

どの単位でまとめたいかの違い。

> 分業にもメリットがある。
> 専業デザイナかサーバサイドエンジニアかフロントエンドエンジニアか職種で気にすることが変わってくる
>   * HTML、JS、CSS どの領域をメインで担当する?

# Railsのエンジニアだと

Railsでサーバサイドをメインで見る人は必然とrouting/controller/model/views(`<-html`)を見る。
先にjsのコードから見る人は多くない。

デザイナはHTMLとCSSを見比べるだろうし、フロントエンドの人はhtml、jsをメインで見ている。

# HTMLだけみてそこでjsが使われているかってわかる？

特に途中から入ったエンジニアはHTML見ただけでその動きがjsと紐付いてるかはわからない。  
HTML、JS、CSSをどのような立ち位置で修正するのか。  
具体的にはデザイナか、サーバサイドエンジニアか、フロントエンドエンジニアであるかで気にすることが変わってくる。  

ここでいう紐付きは**依存**が見えないことを示している。


## ではどうするか

* コンポーネント指向を取り込んで依存を排除する
* 命名規則で依存を明確にする

# コンポーネント指向を取り込む

 > 一つの部品としてデザインと動きのあるものをまとめる単位ではない

* 最近のコンポーネント指向のフロントエンド(React、Polymerとか)利用する
  * テンプレートと動作とスタイルも1つに部品としてまとめることが出来るのでこれを保証できる機構を使う

# 命名規則で頑張る

* 今回はこっち。ここjsと紐付いてるよ！　という依存をパット見でわかるようにする。

> HTMLだけみてそこでjsが使われているかってわかる？

=> これを解決する

# id名、class名の先頭に'js-'なプレフィックスをつける 

HTML見た瞬間に、これ、js使われるな！　ってわかりますね。

```
<ul class="wordList">
  <li><span>fuga</span></li>
  <li><span id='js-alertByClick' class='red'>ここをクリック</span></li>
  <li><span class='red'>hoge</span></li>
</ul>
```

```css
.red {
  background: red
}
```


```javascript
$('#js-alertByClick').on('click', function() { alert('click されました'); })
```

# スタイルガイド 

今回の話はスタイルガイドの領域なので、 チームごとにルールを作ってそれを共有する必要がある。

ちなみにGithubのコーディング規約(https://github.com/styleguide)は

> ## Class naming conventions
>
> Never reference js- prefixed class names from CSS files. js- are used exclusively from JS files.
>
> Use the is- prefix for state rules that are shared between CSS and JS.
(http://primercss.io/guidelines/#class-naming-conventions)

と書いてある

# まとめると

* `js-` のプレフィックスをつける事
* `js-` プレフィックスはCSSから参照されてはならない。排他的制御となるべき。
  * CSSファイルに`js-`が合ってはダメ 
* `is-` でステート管理する
  * `button class="js-toggleActive isActive"`のようなイメージ

# コードリーディングの速度を上げて快適なチーム開発を

コードに規約をもたせると一貫性の有るコードとなり、読んでいて引っかかる事が少なくなる。
依存性の明示にりjsでハマるところを少なくし、コード・リーディングの速度を、ひいてはチーム開発の速度を上げていこう。

