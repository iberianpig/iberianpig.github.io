---
layout: post
title: "Rspecでなぜか@インスタンス変数が参照できない時"
published: true
date: 2014-09-11
comments: true
tags: rspec
categories: rails
---

# controller内の@hogeが参照できない

rspecの世界からcontroller内メソッドでインスタンス変数`@hoge`を利用した場合は、  
直接rspecからインスタンス化された@hogeは参照できません。  
インスタンス化された評価する場合は`assigns(:hoge)`で参照するといいようです。  

また、controller内のメソッドが完了したあと、rspec内で`@hoge.reload`してから評価するという手もあるそうです。

内容深く調査した上で、追記したいと思います。



# その他
当然のことかもしれませんが、itブロック・contextブロック・describeブロックの中で定義した変数はその中に限ります。
それ以外で扱うためにはインスタンス変数を利用する必要があります。
はじめてのテストということでココらへんでハマってしまいましたが、そのおかげでスコープを意識してcontext分けたりできたので良かったと思います。

railsの世界の変数か、rspecの世界の変数なのかをきちんと意識する必要があった。
rspecはrubyの変数が使えるブラウザとrailsと共通で参照できるテスト用DBの3つの大きなスコープがある。
requestヘッダをrspecで作ってそれを使って投げることができる

